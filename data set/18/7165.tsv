2008-12-27T04:02:00.000Z	allquixotic		Does anyone know how to set up a local DNS cache? I would like to have a program running locally that will store DNS lookups from the upstream server on my ISP, because the ISP's lookups take 10+ seconds, and they appear uncached... visiting the same site twice consecutively still leads to slow lookups twice.
2008-12-27T04:03:00.000Z	unop_	allquixotic	http://ubuntu.wordpress.com/2006/08/02/local-dns-cache-for-faster-browsing/
2008-12-27T04:05:00.000Z	unop_	allquixotic	you are not obliged to use a particular DNS server. you can use any public dns server
2008-12-27T04:07:00.000Z	unop_	allquixotic	 grep -i search /etc/resolv.conf
2008-12-27T04:09:00.000Z	allquixotic	unop_	and hspaans: It lists two domains. It's relevant to mention that my situation is complicated by split tunneling on a VPN. I want to access certain sites inside the VPN over the VPN connection, and all other sites outside the VPN with my raw internet connection. That part works flawlessly; I've checked the routing by asking remote servers what my public IP is, and it indeed splits the tunneling fine.
2008-12-27T04:09:00.000Z	allquixotic	unop_	hspaans: But my search domain lists first the VPN domain, followed by the NAT domain. Both the VPN's DNS server and my router's DNS are capable of public Internet access, and both are fast if you're directly connected to the respective network.
2008-12-27T04:10:00.000Z	unop_	allquixotic	when you do nslookups against your primary DNS server - are responses fast?
2008-12-27T04:11:00.000Z	allquixotic	unop_	What is the command line switch to tell nslookup which dns server to query?
2008-12-27T04:12:00.000Z	allquixotic	unop_	The man page is not very descriptive... a plain old `nslookup www.google.com` is slow, but it's not telling me which DNS server it used.
2008-12-27T04:12:00.000Z	unop_	allquixotic	in the nslookup shell ..   server ns1.example.com
2008-12-27T04:14:00.000Z	allquixotic	unop_	hspaans: Wow. In the nslookup shell I put in "server 192.168.1.1" (my NAT DNS) and even websites I haven't visited in forever are VERY fast.
2008-12-27T04:15:00.000Z	unop_	allquixotic	ok, but what is your current primary DNS server?
2008-12-27T04:15:00.000Z	allquixotic	unop_	my primary DNS server is on the NAT, I suppose, because it's the first entry in the list in /etc/resolv.conf -- right?
2008-12-27T04:16:00.000Z	unop_	allquixotic	that could be the problem - if the VPN DNS server is not set to resolve external domains, it could slow things down - is that the case?
2008-12-27T04:19:00.000Z	allquixotic	unop_	Whoa. Now we're getting somewhere! I'm getting a _timeout_ when I try to resolve any Internet-facing host using a VPN-provided DNS server that `vpnc` inserts into my /etc/resolv.conf. But when I ask the very same DNS server to resolve an internal DNS name inside the VPN's network, it's instantaneous.
2008-12-27T04:19:00.000Z	allquixotic	unop_	So, to answer your question: Yes, the VPN DNS server is _not_ set to resolve external domains. It just times out.
2008-12-27T04:21:00.000Z	allquixotic	unop_	It seems like if I ask my NAT's DNS to resolve something inside the VPN, I'm gonna get a timeout or error; and if I ask the VPN's DNS to resolve something outside the VPN, I'm gonna get a timeout or error. So I have to choose whether I want to wait for Internet DNS queries or VPN DNS queries?...
2008-12-27T05:29:00.000Z	allquixotic	unop_	I got the program dnsmasq to cache up to 1000 DNS entries. Also, it simultaneously pings both VPN and NAT servers, and the first one to respond is returned by dnsmasq. By putting 127.0.0.1 as first in resolv.conf, I get DNS lookups of about 100 msec for an uncached domain, either public internet or VPN; and less than a millisecond for cached ones. Awesome!
