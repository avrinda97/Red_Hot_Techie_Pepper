2011-08-01T17:37:00.000Z	sipior	wols	you want swap to hold unallocated memory reservations, else you will be wasting ram. sparing €0.10/GB hard drive space for €20/GB RAM is a false economy, to put it mildly.
2011-08-01T17:38:00.000Z	wols	sipior	what is unallocated memory reservations? I know allocated and I know committed
2011-08-01T17:40:00.000Z	sipior	wols	memory allocations made by processes at initialisation. the reservation is typically quite a bit larger than what the process expects to allocate, and so you get sections of RAM which can't be recycled (they are still reserved), but aren't being used by the process that requested them.
2011-08-01T17:40:00.000Z	sipior	wols	linux memory allocation is fairly aggressive :-)
2011-08-01T17:41:00.000Z	wols	sipior	makes no sense. there is no need to put anything on disk (which means writing which is slow) when a page is not dirty
2011-08-01T17:41:00.000Z	wols	sipior	and if you don't put it on disk then there is no need for the swap
2011-08-01T17:41:00.000Z	sipior	wols	if you have swap, those reservations are swapped directly. there's no performance hit, because nothing is actually being written to disk. the reservations do need to exist.
2011-08-01T17:42:00.000Z	wols	sipior	basically, if I malloc 2GB then the kernel should do some bookeeping but shouldn't give me a single byte. only when I calloc 2GB (or otherwise wirte to my allocated pages), only then it should matter for the VM and swap
2011-08-01T17:57:00.000Z	sipior	wols	sorry, had to see a man about a dog. here's a link which may be of interest: http://www.linux.com/news/software/applications/8208-all-about-linux-swap-space (the comment by "Tony" is of particular relevance).
2011-08-01T18:01:00.000Z	wols	sipior	while I agree with the unpredictability of what gets killed by OOM, I don't follow his other argument: as he says: there is no real I/O taking place. hence I don't need it since it's not actually used. except in the (rare) happening of the overcommit which is actually needed
2011-08-01T18:01:00.000Z	wols	sipior	ie I don#t have any negative results unless OOM actually hits
2011-08-01T18:02:00.000Z	wols	sipior	the memory which is allocated and not used internally isn't simply kept free "in case I need it", it's still used as cache normally. as I said: all internal bookkeeping
2011-08-01T18:03:00.000Z	sipior	wols	his (the commenter's) point is that the VM subsystem *must* guarantee that the space exists, whether or not that's a good idea. writing those allocations to swap keeps them from wasting your ram. they can't be used for cache, because they are still tied up by the process that reserved them.
2011-08-01T18:06:00.000Z	wols	sipior	no. allocation is never commit. linux _always_ overcommits cause it's the sensible thing to do. with swap, the overcommit just happens later, that is all. but performance wise there is no difference. The kernel doesn't have to guarantee anything. if it would guarantee, there would be no OOM killer needed. but it's obviously there
2011-08-01T18:08:00.000Z	wols	sipior	the only stuff you could put into swap is the binaries' "dead ends". code that is never ever used or data that is never accessed. you can swap that out and make room for more useful cache. that's about it. but with big memory sizes, this is not really needed anymore since the amount is so small. at least in linux where we have proper systemwide shared libs, unlike windows...
2011-08-01T18:09:00.000Z	wols	sipior	and for the kernel to actually do that you ahve to do that andrew morton thing and set swappiness to 100%
2011-08-01T18:10:00.000Z	sipior	wols	yes, i said that badly. the kernel makes no guarantees, and so having plentiful swap space is a way of ensuring *reliability* in the face of an unpredictable environment. that's why we need swap.
2011-08-01T18:10:00.000Z	sipior	wols	and as i said earlier, trading off cheap hard drive space for expansive ram is not very clever.
2011-08-01T18:11:00.000Z	wols	sipior	I wouldn't say "need" :P  but these are the differences in approach I guess :)
2011-08-01T18:12:00.000Z	wols	sipior	it all depends on workload. having seen how my systems never used swap, I just got pissed at all the wasted space and eliminated it. only times I had OOM killer hit was when e.g. my apache (or mysql) had some runaway memory leak. never in normal operation
2011-08-01T18:13:00.000Z	wols	sipior	if I did more java dev for example I might have kept swap around. those java IDEs are just hogs for memory
2011-08-01T18:14:00.000Z	sipior	wols	i certainly won't argue there.
