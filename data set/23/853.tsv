2011-01-11T18:54:00.000Z	carl-eric		Hi everybody. I'm seeing serious performance issues with my fresh 10.10 install and encrypted home directories (ecryptfs). Listing big directories takes sometimes up to five minutes.
2011-01-11T18:54:00.000Z	FCGreg	carl-eric	hmmm, i have the exact same setup with no problems.
2011-01-11T18:54:00.000Z	carl-eric		I've seen an upstream report that says this is expected with ecryptfs, so I'm looking for alternatives.
2011-01-11T18:55:00.000Z	FCGreg	carl-eric	how big are these directories?  (how many files?)
2011-01-11T18:55:00.000Z	carl-eric	FCGreg	These are directories with thousands of files in them, and sometimes a whole directory tree needs to be scanned, that can run up to tens of thousands of files
2011-01-11T18:56:00.000Z	carl-eric	FCGreg	photo shoots - i.e. lots of picture files, along with metadata files, edited pictures, etc.
2011-01-11T18:56:00.000Z	FCGreg	carl-eric	hmmm, i haven't tested it with THAT many files in them, but i don't notice a slowdown at all.  my hardware is not that new, either.  what kind of hardware are you running?
2011-01-11T18:57:00.000Z	carl-eric	FCGreg	It's a brand-new 6 core AMD with soft raid mirroring on 2 2TB SATA drives. It should be blazing fast.
2011-01-11T18:57:00.000Z	FCGreg	carl-eric	also, what file system are you using underneath ecrypt-fs?  some file systems have problems with large directories/trees all by themselves.
2011-01-11T18:58:00.000Z	carl-eric	FCGreg	uh... I think I didn't change the default. Probably ext4 (not at home right now where I could check, but it's definitely either ext3 or ext4.) I didn't have this problem on my previous machine, which was plain ext3 without eCryptfs.
2011-01-11T18:58:00.000Z	FCGreg	carl-eric	unless you were running this configuration prior to ecrypt i would test in the same confirmation without using ecrypt with the same underlying filesystem to ensure your raid or something else isn't causing a slowdown
2011-01-11T18:59:00.000Z	carl-eric	FCGreg	the RAID is the linux kernel raid set up by the Ubuntu installer. The previous machine was the same kind of setup, only slower disks and less cores ;-)
2011-01-11T18:59:00.000Z	FCGreg	carl-eric	i saw a bug report recently about ext4 filesystems with certain types of files in them having slowdown issues (e.g. large numbers of files combined with files of certain types).  maybe you're running into this issue?
2011-01-11T19:00:00.000Z	FCGreg	carl-eric	i am still using ext3 on my setup.  not sure if that is affecting you or not.  i don't remember all of the details, sorry
2011-01-11T19:03:00.000Z	carl-eric	FCGreg	I saw a bug yesterday (can't find the link right now, still looking) that said that ecryptfs needs to read some bytes from every file for stat() calls, which is what some directory scanning applications do for every file. It was said there that for big directories that would be a serious performance hit. It's marked as WONTFIX, since it's due to ecryptfs's design. I'm actually looking for alternatives to ecryptfs
2011-01-11T19:04:00.000Z	carl-eric	FCGreg	I looked at just whole disk encryption (that works fine on a different machine) but that won't isolate different accounts from each other
2011-01-11T19:05:00.000Z	FCGreg	carl-eric	i understand. that is true, and it *does* depend on how the affected application is calling the directory.  to work around that you will need any encrypted filesystem solution that does NOT do file-by-file encryption in userspace.  in other words, you will need something that gives you an encrypted container for your home directory and mounts it for you.  perhaps something with luks integration.
2011-01-11T19:06:00.000Z	carl-eric	FCGreg	that's what I thought. Is it possible to set up e.g. luks so it will be mounted upon login (maybe with pam_mount)?
2011-01-11T19:07:00.000Z	FCGreg	carl-eric	i haven't checked integrated solutions like this for Linux lately, but you basically want something like filevault on the Mac platform.
2011-01-11T19:08:00.000Z	carl-eric	FCGreg	I have dealt with pam_mount before, also with luks, and also truecrypt. Individually, I can handle them easily :-) I just don't know how to do auto-mounted home directories with pam_mount
2011-01-11T19:08:00.000Z	FCGreg	carl-eric	maybe you can search for "filevault ubuntu" or similar to get some results. (sorry I haven't researched those solutions in a while... in the past i had to do that with my own scripted solutions)
2011-01-11T19:08:00.000Z	carl-eric	FCGreg	Ok, thank you, will do
2011-01-11T19:09:00.000Z	FCGreg	carl-eric	you're welcome.  good luck with it
